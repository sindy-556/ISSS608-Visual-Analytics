<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sindy">

<title>Take-home Exercise 3: GeBiz Procurement Data Visualization Prototype – ISSS608 VAA 🎨</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-f3c2ea88cadbcfb37ba28ffa2c97cfc1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS608 VAA 🎨</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-ex-part-1" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Ex Part 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-ex-part-1">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex00.html">
 <span class="dropdown-text">Hands-on Exercise 0</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex03a.html">
 <span class="dropdown-text">Hands-on Exercise 3a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex03b.html">
 <span class="dropdown-text">Hands-on Exercise 3b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex04a.html">
 <span class="dropdown-text">Hands-on Exercise 4a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex04b.html">
 <span class="dropdown-text">Hands-on Exercise 4b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex04c.html">
 <span class="dropdown-text">Hands-on Exercise 4c</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex04d.html">
 <span class="dropdown-text">Hands-on Exercise 4d</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-ex-part-2" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Ex Part 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-ex-part-2">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex05a.html">
 <span class="dropdown-text">Hands-on Exercise 5a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex05b.html">
 <span class="dropdown-text">Hands-on Exercise 5b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex05c.html">
 <span class="dropdown-text">Hands-on Exercise 5c</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex05d.html">
 <span class="dropdown-text">Hands-on Exercise 5d</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex05e.html">
 <span class="dropdown-text">Hands-on Exercise 5e</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex07.html">
 <span class="dropdown-text">Hands-on Exercise 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex08a.html">
 <span class="dropdown-text">Hands-on Exercise 8a</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex08b.html">
 <span class="dropdown-text">Hands-on Exercise 8b</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex08c.html">
 <span class="dropdown-text">Hands-on Exercise 8c</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex09.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In-class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="https://public.tableau.com/app/profile/sindy.hua/viz/In-class_Ex01_17371867037820/L1">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://public.tableau.com/app/profile/sindy.hua/viz/In-class_Ex02_17377911301680/L2">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://public.tableau.com/app/profile/sindy.hua/viz/In-class_Ex03_17383922555560/Story1">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex04/In-class_Ex04.html">
 <span class="dropdown-text">In-class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex05/In-class_Ex05.html">
 <span class="dropdown-text">In-class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://simplysindy.shinyapps.io/shiny_basics/">
 <span class="dropdown-text">In-class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex07/In-class_Ex07.html">
 <span class="dropdown-text">In-class Exercise 7</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take-home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../Take-home_Ex/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Take-home_Ex/Take-home_Ex2.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Take-home_Ex/Take-home_Ex3.html">
 <span class="dropdown-text">Take-home Exercise 3</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">🚀 Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">💡️ About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">1. Overview</a></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">2. Data Preparation</a>
  <ul class="collapse">
  <li><a href="#loading-and-enriching-data" id="toc-loading-and-enriching-data" class="nav-link" data-scroll-target="#loading-and-enriching-data">2.1 Loading and Enriching Data</a></li>
  <li><a href="#extracting-supplier-grades" id="toc-extracting-supplier-grades" class="nav-link" data-scroll-target="#extracting-supplier-grades">2.2 Extracting Supplier Grades</a></li>
  <li><a href="#joining-data-and-creating-an-enriched-dataset" id="toc-joining-data-and-creating-an-enriched-dataset" class="nav-link" data-scroll-target="#joining-data-and-creating-an-enriched-dataset">2.3 Joining Data and Creating an Enriched Dataset</a></li>
  <li><a href="#verifying-data-enrichment" id="toc-verifying-data-enrichment" class="nav-link" data-scroll-target="#verifying-data-enrichment">2.4 Verifying Data Enrichment</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis">2.5 Exploratory Data Analysis</a></li>
  <li><a href="#temporal-patterns" id="toc-temporal-patterns" class="nav-link" data-scroll-target="#temporal-patterns">2.6 Temporal Patterns</a></li>
  <li><a href="#distribution-of-award-amounts" id="toc-distribution-of-award-amounts" class="nav-link" data-scroll-target="#distribution-of-award-amounts">2.7 Distribution of Award Amounts</a></li>
  <li><a href="#relationship-between-variables" id="toc-relationship-between-variables" class="nav-link" data-scroll-target="#relationship-between-variables">2.8 Relationship Between Variables</a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">3. Data Preprocessing</a>
  <ul class="collapse">
  <li><a href="#date-conversion-and-handling-missing-values" id="toc-date-conversion-and-handling-missing-values" class="nav-link" data-scroll-target="#date-conversion-and-handling-missing-values">3.1 Date Conversion and Handling Missing Values</a></li>
  </ul></li>
  <li><a href="#building-the-sankey-diagram-visualization" id="toc-building-the-sankey-diagram-visualization" class="nav-link" data-scroll-target="#building-the-sankey-diagram-visualization">4. Building the Sankey Diagram Visualization</a></li>
  <li><a href="#creating-sankey-visualization-examples" id="toc-creating-sankey-visualization-examples" class="nav-link" data-scroll-target="#creating-sankey-visualization-examples">5. Creating Sankey Visualization Examples</a>
  <ul class="collapse">
  <li><a href="#filtering-by-ministry" id="toc-filtering-by-ministry" class="nav-link" data-scroll-target="#filtering-by-ministry">5.1 Filtering by Ministry</a></li>
  <li><a href="#filtering-by-agency" id="toc-filtering-by-agency" class="nav-link" data-scroll-target="#filtering-by-agency">5.2 Filtering by Agency</a></li>
  <li><a href="#filtering-by-suppliers" id="toc-filtering-by-suppliers" class="nav-link" data-scroll-target="#filtering-by-suppliers">5.3 Filtering by Suppliers</a></li>
  <li><a href="#top-k-analysis" id="toc-top-k-analysis" class="nav-link" data-scroll-target="#top-k-analysis">5.4 Top K Analysis</a></li>
  </ul></li>
  <li><a href="#ui-design-for-interactive-dashboard" id="toc-ui-design-for-interactive-dashboard" class="nav-link" data-scroll-target="#ui-design-for-interactive-dashboard">6. UI Design for Interactive Dashboard</a>
  <ul class="collapse">
  <li><a href="#dashboard-layout" id="toc-dashboard-layout" class="nav-link" data-scroll-target="#dashboard-layout">6.1 Dashboard Layout</a></li>
  <li><a href="#control-panel-components" id="toc-control-panel-components" class="nav-link" data-scroll-target="#control-panel-components">6.2 Control Panel Components</a></li>
  <li><a href="#visualization-area-components" id="toc-visualization-area-components" class="nav-link" data-scroll-target="#visualization-area-components">6.3 Visualization Area Components</a></li>
  <li><a href="#information-panel-components" id="toc-information-panel-components" class="nav-link" data-scroll-target="#information-panel-components">6.4 Information Panel Components</a></li>
  <li><a href="#interactive-features" id="toc-interactive-features" class="nav-link" data-scroll-target="#interactive-features">6.5 Interactive Features</a></li>
  <li><a href="#color-scheme-and-accessibility" id="toc-color-scheme-and-accessibility" class="nav-link" data-scroll-target="#color-scheme-and-accessibility">6.6 Color Scheme and Accessibility</a></li>
  <li><a href="#mockup-preview" id="toc-mockup-preview" class="nav-link" data-scroll-target="#mockup-preview">6.7 Mockup Preview</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 3: GeBiz Procurement Data Visualization Prototype</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sindy </p>
          </div>
  </div>
    
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">March 30, 2025</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">1. Overview</h2>
<p>This document presents a visualization prototype for GeBiz procurement data. We will focus on creating Sankey diagrams to visualize procurement flows from ministries to agencies to suppliers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(dplyr, stringr, lubridate, networkD3, tidyverse, </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>               plotly, DT, viridis, scales, htmlwidgets, htmltools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">2. Data Preparation</h2>
<section id="loading-and-enriching-data" class="level3">
<h3 class="anchored" data-anchor-id="loading-and-enriching-data">2.1 Loading and Enriching Data</h3>
<p>Before creating our visualizations, we need to load and prepare the relevant datasets. We’re working with with the GeBiz dataset and 2 other dataset that sourced online:</p>
<ol type="1">
<li><p>Procurement transaction data - the core dataset with details of each procurement activity from GeBiz</p></li>
<li><p>Supplier financial information - containing grading data for suppliers (note: this dataset is incomplete, as we were unable to obtain financial grades for all suppliers)</p></li>
</ol>
<p>3, Agency mapping data - providing the hierarchical relationships between agencies and ministries</p>
<p>The code below loads these datasets from CSV files into R data frames. We’ll need to handle the incomplete nature of the supplier financial data during our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the necessary datasets</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>procurement_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/GovernmentProcurementviaGeBIZ.csv'</span>)  <span class="co"># Procurement data CSV</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>financial_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/supplier_details.csv'</span>)  <span class="co"># CSV with supplier financial grades</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>agency_mapping_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'data/agency_mapping.csv'</span>)  <span class="co"># Agency mapping data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="extracting-supplier-grades" class="level3">
<h3 class="anchored" data-anchor-id="extracting-supplier-grades">2.2 Extracting Supplier Grades</h3>
<p>The <code>financial_df</code> dataset contains supplier grade information, which indicates the financial capacity of each supplier. The Singapore government classifies suppliers on a scale from S2 to S10, with each grade corresponding to specific monetary thresholds:</p>
<ul>
<li>S2: $100,000 (EPU S2)</li>
<li>S3: $250,000 (EPU S3)</li>
<li>S4: $500,000 (EPU S4)</li>
<li>S5: $1,000,000 (EPU S5)</li>
<li>S6: $3,000,000 (EPU S6)</li>
<li>S7: $5,000,000 (EPU S7)</li>
<li>S8: $10,000,000 (EPU S8)</li>
<li>S9: $30,000,000 (EPU S9)</li>
<li>S10: &gt;$30,000,000 (EPU S10)</li>
</ul>
<p>Higher grades (S8-S10) represent larger companies with greater financial capacity, while lower grades (S2-S4) represent smaller contractors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to extract just the S-grade (S2-S10) from the financial grade string</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>extract_s_grade <span class="ot">&lt;-</span> <span class="cf">function</span>(grade_string) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(grade_string)) {</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use regex to extract S followed by a number</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  match <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(grade_string, <span class="st">"S</span><span class="sc">\\</span><span class="st">d+"</span>)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(match)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simplified financial grades</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>financial_df<span class="sc">$</span>financial_grade <span class="ot">&lt;-</span> <span class="fu">sapply</span>(financial_df<span class="sc">$</span>financial_grade, extract_s_grade)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mapping dataframes for lookups</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>supplier_grade_map <span class="ot">&lt;-</span> financial_df <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(supplier_name, financial_grade) <span class="sc">%&gt;%</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since we were unable to obtain financial grades for all suppliers in our procurement dataset, we’ll need to handle missing values appropriately in our analysis. We’ll need to account for the incomplete coverage in our visualizations and interpretations.</p>
</section>
<section id="joining-data-and-creating-an-enriched-dataset" class="level3">
<h3 class="anchored" data-anchor-id="joining-data-and-creating-an-enriched-dataset">2.3 Joining Data and Creating an Enriched Dataset</h3>
<p>To create comprehensive visualizations, we need to combine all our datasets into one enriched procurement dataset. This includes:</p>
<ol type="1">
<li>Adding supplier financial grades to the procurement records</li>
<li>Adding ministry information to the agencies</li>
<li>Creating standardized abbreviations for agencies and ministries for cleaner visualization</li>
</ol>
<p>The code below performs these join operations and creates our main analysis dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_df <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(supplier_grade_map, <span class="at">by =</span> <span class="st">"supplier_name"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>agency_mapping <span class="ot">&lt;-</span> agency_mapping_df <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(agency, agency_abbr, ministry, ministry_abbr)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(agency_mapping, <span class="at">by =</span> <span class="st">"agency"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(procurement_enriched, <span class="st">'procurement_output.csv'</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="verifying-data-enrichment" class="level3">
<h3 class="anchored" data-anchor-id="verifying-data-enrichment">2.4 Verifying Data Enrichment</h3>
<p>After joining the datasets, it’s important to verify that the enrichment was successful and understand the extent of missing data. The code below reports statistics on the completeness of our enriched dataset, including:</p>
<ul>
<li>Total number of procurement records</li>
<li>Records with financial grades (expected to be incomplete due to data limitations)</li>
<li>Records with agency abbreviations</li>
<li>Records with ministry information</li>
</ul>
<p>This verification step is particularly important given that we’re working with external datasets of varying completeness. Understanding these limitations will help us design appropriate visualizations and interpret results accurately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total procurement records:"</span>, <span class="fu">nrow</span>(procurement_enriched), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total procurement records: 18638 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Records with financial grades:"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(procurement_enriched<span class="sc">$</span>financial_grade)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Records with financial grades: 11994 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Records with agency abbreviations:"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(procurement_enriched<span class="sc">$</span>agency_abbr)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Records with agency abbreviations: 18638 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Records with ministry information:"</span>, <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(procurement_enriched<span class="sc">$</span>ministry)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Records with ministry information: 18638 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(procurement_enriched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18,638
Columns: 11
$ tender_no            &lt;chr&gt; "ACR000ETT18300010", "ACR000ETT18300011", "ACR000…
$ tender_description   &lt;chr&gt; "SUPPLY, DESIGN, DEVELOPMENT, CUSTOMIZATION, DELI…
$ agency               &lt;chr&gt; "Accounting And Corporate Regulatory Authority", …
$ award_date           &lt;chr&gt; "11/6/2019", "10/5/2019", "30/4/2019", "29/8/2019…
$ tender_detail_status &lt;chr&gt; "Awarded to Suppliers", "Awarded to No Suppliers"…
$ supplier_name        &lt;chr&gt; "AZAAS PTE. LTD.", "Unknown", "ACCENTURE SG SERVI…
$ awarded_amt          &lt;dbl&gt; 2305880.0, 0.0, 2035000.0, 30700373.9, 178800.0, …
$ financial_grade      &lt;chr&gt; "S9", NA, "S10", "S10", NA, "S10", "S10", "S10", …
$ agency_abbr          &lt;chr&gt; "ACRA", "ACRA", "ACRA", "ACRA", "ACRA", "ACRA", "…
$ ministry             &lt;chr&gt; "MINISTRY OF FINANCE", "MINISTRY OF FINANCE", "MI…
$ ministry_abbr        &lt;chr&gt; "MOF", "MOF", "MOF", "MOF", "MOF", "MOF", "MOF", …</code></pre>
</div>
</div>
</section>
<section id="exploratory-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exploratory-data-analysis">2.5 Exploratory Data Analysis</h3>
<section id="basic-summary-statistics-for-key-numeric-variables." class="level4">
<h4 class="anchored" data-anchor-id="basic-summary-statistics-for-key-numeric-variables.">Basic summary statistics for key numeric variables.</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(procurement_df<span class="sc">$</span>awarded_amt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
0.000e+00 7.000e+03 1.647e+05 5.540e+06 8.227e+05 1.493e+09 </code></pre>
</div>
</div>
</section>
<section id="count-of-records-by-year-to-understand-the-temporal-distribution" class="level4">
<h4 class="anchored" data-anchor-id="count-of-records-by-year-to-understand-the-temporal-distribution">Count of records by year to understand the temporal distribution</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>yearly_counts <span class="ot">&lt;-</span> procurement_df <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(award_date, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_value =</span> <span class="fu">median</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(yearly_counts)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year count  total_value avg_value median_value
  &lt;dbl&gt; &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;        &lt;dbl&gt;
1  2019  3085 16059483098.  5205667.      188446 
2  2020  3475 16464137733.  4737881.      139185.
3  2021  3968 22112113338.  5572609.      154595 
4  2022  3464 21410618127.  6180894.      168960 
5  2023  3712 20563061381.  5539618.      156255 
6  2024   934  6641402748.  7110710.      243375 </code></pre>
</div>
</div>
</section>
<section id="examine-the-distribution-of-procurement-by-ministry-and-agency" class="level4">
<h4 class="anchored" data-anchor-id="examine-the-distribution-of-procurement-by-ministry-and-agency">Examine the distribution of procurement by ministry and agency</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>ministry_distribution <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(ministry) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value))</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ministry_distribution, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   ministry                                        count  total_value avg_value
   &lt;chr&gt;                                           &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;
 1 MINISTRY OF TRANSPORT                            1163 35664601010. 30666037.
 2 MINISTRY OF NATIONAL DEVELOPMENT                 2033 25698029271. 12640447.
 3 MINISTRY OF SUSTAINABILITY AND THE ENVIRONMENT   1712 12576675306.  7346189.
 4 MINISTRY OF TRADE AND INDUSTRY                   2628  6357920701   2419300.
 5 MINISTRY OF EDUCATION                            3011  5411058603.  1797097.
 6 MINISTRY OF HOME AFFAIRS                          824  5016127066.  6087533.
 7 MINISTRY OF HEALTH                               1142  3593118020.  3146338.
 8 MINISTRY OF CULTURE, COMMUNITY AND YOUTH         1587  2410346023.  1518807.
 9 MINISTRY OF FINANCE                               848  1305103449.  1539037.
10 MINISTRY OF DIGITAL DEVELOPMENT AND INFORMATION  1296  1158374359.   893807.</code></pre>
</div>
</div>
</section>
<section id="top-agencies-by-procurement-value" class="level4">
<h4 class="anchored" data-anchor-id="top-agencies-by-procurement-value">Top agencies by procurement value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>agency_distribution <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(agency) <span class="sc">%&gt;%</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value))</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(agency_distribution, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   agency                                            count total_value avg_value
   &lt;chr&gt;                                             &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 Land Transport Authority                            753     3.47e10 46117155.
 2 Housing and Development Board                      1218     2.44e10 20000790.
 3 Public Utilities Board                              938     6.92e 9  7372103.
 4 National Environment Agency                         508     5.30e 9 10430255.
 5 Jurong Town Corporation                             589     3.91e 9  6632663.
 6 Ministry of Home Affairs - Ministry Headquarter 1   465     3.55e 9  7631497.
 7 Ministry of Education                               647     3.49e 9  5389535.
 8 Ministry of Health-Ministry Headquarter             381     2.88e 9  7564464.
 9 Ministry of Home Affairs-Ministry Headquarter       207     1.32e 9  6376422.
10 People's Association                                884     1.01e 9  1137689.</code></pre>
</div>
</div>
</section>
<section id="top-suppliers-by-procurement-value" class="level4">
<h4 class="anchored" data-anchor-id="top-suppliers-by-procurement-value">Top suppliers by procurement value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>supplier_distribution <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(supplier_distribution, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   supplier_name                                     count total_value avg_value
   &lt;chr&gt;                                             &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
 1 PENTA-OCEAN CONSTRUCTION COMPANY LIMITED              5 2703160550     5.41e8
 2 WOH HUP (PRIVATE) LIMITED                             3 2241896200     7.47e8
 3 CHINA COMMUNICATIONS CONSTRUCTION COMPANY LTD.        4 1836067980.    4.59e8
 4 RICH CONSTRUCTION COMPANY PTE. LTD.                   6 1733331271     2.89e8
 5 SHANGHAI TUNNEL ENGINEERING CO (SINGAPORE) PTE L…     4 1682948000     4.21e8
 6 KEPPEL SEGHERS ENGINEERING SINGAPORE PTE. LTD.        1 1493179167     1.49e9
 7 KAY LIM CONSTRUCTION &amp; TRADING PTE LTD                9 1394038000     1.55e8
 8 CES ENGINEERING &amp; CONSTRUCTION PTE. LTD.              4 1223080000     3.06e8
 9 CES_SDC PTE. LTD.                                     3 1222110222     4.07e8
10 NEWCON BUILDERS PTE. LTD.                             7 1217160000     1.74e8</code></pre>
</div>
</div>
</section>
<section id="distribution-of-suppliers-by-financial-grade" class="level4">
<h4 class="anchored" data-anchor-id="distribution-of-suppliers-by-financial-grade">Distribution of suppliers by financial grade</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>grade_distribution <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(financial_grade) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">unique_suppliers =</span> <span class="fu">n_distinct</span>(supplier_name),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_value =</span> <span class="fu">round</span>(total_value<span class="sc">/</span><span class="fu">sum</span>(procurement_enriched<span class="sc">$</span>awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_contract_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value))</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(grade_distribution)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 6
   financial_grade count unique_suppliers  total_value pct_value
   &lt;chr&gt;           &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;
 1 &lt;NA&gt;             6644             3178 71313233781.     69.1 
 2 S10              4414              569 25177217610.     24.4 
 3 S8               2919              751  2442910142.      2.37
 4 S9               1068              245  2413997429.      2.34
 5 S7               2318              860  1535306836.      1.49
 6 S6                618              264   216864117.      0.21
 7 S5                368              191    96560958.      0.09
 8 S4                212              124    38664019.      0.04
 9 S3                 48               34    10734680.      0.01
10 S2                 29               14     5326854.      0.01
# ℹ 1 more variable: avg_contract_value &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="distribution-by-consolidated-financial-category" class="level4">
<h4 class="anchored" data-anchor-id="distribution-by-consolidated-financial-category">Distribution by consolidated financial category</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">"financial_category"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(procurement_enriched)) {</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">financial_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>, <span class="st">"S4"</span>) <span class="sc">~</span> <span class="st">"Small (S1-S4)"</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S5"</span>, <span class="st">"S6"</span>, <span class="st">"S7"</span>) <span class="sc">~</span> <span class="st">"Medium (S5-S7)"</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S8"</span>, <span class="st">"S9"</span>, <span class="st">"S10"</span>) <span class="sc">~</span> <span class="st">"Large (S8-S10)"</span>,</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unspecified Grade"</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>category_distribution <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(financial_category) <span class="sc">%&gt;%</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">unique_suppliers =</span> <span class="fu">n_distinct</span>(supplier_name),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">pct_value =</span> <span class="fu">round</span>(total_value<span class="sc">/</span><span class="fu">sum</span>(procurement_enriched<span class="sc">$</span>awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)<span class="sc">*</span><span class="dv">100</span>, <span class="dv">2</span>),</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_contract_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value))</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(category_distribution)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 6
  financial_category count unique_suppliers  total_value pct_value
  &lt;chr&gt;              &lt;int&gt;            &lt;int&gt;        &lt;dbl&gt;     &lt;dbl&gt;
1 Unspecified Grade   6644             3178 71313233781.     69.1 
2 Large (S8-S10)      8401             1565 30034125180.     29.1 
3 Medium (S5-S7)      3304             1315  1848731910.      1.79
4 Small (S1-S4)        289              172    54725553.      0.05
# ℹ 1 more variable: avg_contract_value &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="are-contracts-awarded-consistently-with-financial-capacity" class="level4">
<h4 class="anchored" data-anchor-id="are-contracts-awarded-consistently-with-financial-capacity">Are contracts awarded consistently with financial capacity?</h4>
<p>This checks if higher-grade suppliers tend to get higher-value contracts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>grade_contract_match <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(financial_grade)) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(financial_grade) <span class="sc">%&gt;%</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_contract_value =</span> <span class="fu">median</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_contract_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_contract_value =</span> <span class="fu">max</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_awarded =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">contract_count =</span> <span class="fu">n</span>()</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(financial_grade)</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(grade_contract_match)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 × 6
  financial_grade median_contract_value avg_contract_value max_contract_value
  &lt;chr&gt;                           &lt;dbl&gt;              &lt;dbl&gt;              &lt;dbl&gt;
1 S10                           423925            5703946.        1025102939 
2 S2                             40000             183685.           3204100 
3 S3                             53175             223639.           1785714.
4 S4                             43324.            182377.           4467000 
5 S5                             71979.            262394.           5588000 
6 S6                            112100             350913.           7242693.
7 S7                            133288.            662341.          36968832 
8 S8                            140480.            836900.          95742051.
9 S9                            338275            2260297.          80784392 
# ℹ 2 more variables: total_awarded &lt;dbl&gt;, contract_count &lt;int&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="temporal-patterns" class="level3">
<h3 class="anchored" data-anchor-id="temporal-patterns">2.6 Temporal Patterns</h3>
<section id="examine-monthly-patterns-in-procurement" class="level4">
<h4 class="anchored" data-anchor-id="examine-monthly-patterns-in-procurement">Examine monthly patterns in procurement</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(procurement_enriched<span class="sc">$</span>award_date, <span class="st">"Date"</span>)) {</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">award_date =</span> <span class="fu">as.Date</span>(award_date, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>monthly_patterns <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(award_date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(award_date)) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter to include only the relevant years (2019-2023)</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year <span class="sc">&lt;=</span> <span class="dv">2023</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year, month) <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plot-monthly-patterns-across-years-with-improved-styling" class="level4">
<h4 class="anchored" data-anchor-id="plot-monthly-patterns-across-years-with-improved-styling">Plot monthly patterns across years with improved styling</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>year_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"2019"</span> <span class="ot">=</span> <span class="st">"#1f77b4"</span>, <span class="st">"2020"</span> <span class="ot">=</span> <span class="st">"#ff7f0e"</span>, </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2021"</span> <span class="ot">=</span> <span class="st">"#2ca02c"</span>, <span class="st">"2022"</span> <span class="ot">=</span> <span class="st">"#d62728"</span>, </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">"2023"</span> <span class="ot">=</span> <span class="st">"#9467bd"</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(monthly_patterns, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> total_value, <span class="at">group =</span> year, <span class="at">color =</span> <span class="fu">factor</span>(year))) <span class="sc">+</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span>  </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monthly Procurement Patterns (2019-2023)"</span>,</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Comparing monthly procurement values across years"</span>,</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Total Procurement Value (SGD)"</span>,</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"right"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> year_colors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex3_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="distribution-of-award-amounts" class="level3">
<h3 class="anchored" data-anchor-id="distribution-of-award-amounts">2.7 Distribution of Award Amounts</h3>
<p>Create a histogram of award amounts to see the distribution</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(procurement_enriched, <span class="fu">aes</span>(<span class="at">x =</span> awarded_amt)) <span class="sc">+</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span>  <span class="co"># Log scale for better visualization</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Award Amounts (Log Scale)"</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Award Amount (Log Scale)"</span>,</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex3_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="box-plot-of-award-amounts-by-financial-category" class="level4">
<h4 class="anchored" data-anchor-id="box-plot-of-award-amounts-by-financial-category">Box plot of award amounts by financial category</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="st">"financial_category"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(procurement_enriched)) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">financial_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>, <span class="st">"S4"</span>) <span class="sc">~</span> <span class="st">"Small (S1-S4)"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S5"</span>, <span class="st">"S6"</span>, <span class="st">"S7"</span>) <span class="sc">~</span> <span class="st">"Medium (S5-S7)"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>      financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S8"</span>, <span class="st">"S9"</span>, <span class="st">"S10"</span>) <span class="sc">~</span> <span class="st">"Large (S8-S10)"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unspecified Grade"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(procurement_enriched, <span class="fu">aes</span>(<span class="at">x =</span> financial_category, <span class="at">y =</span> awarded_amt)) <span class="sc">+</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span>  <span class="co"># Log scale for better visualization</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Distribution of Award Amounts by Supplier Category"</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Supplier Financial Category"</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Award Amount (Log Scale)"</span>) <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex3_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Understanding missing supplier grade information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>financial_grade_coverage <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(procurement_enriched<span class="sc">$</span>financial_grade)) <span class="sc">/</span> <span class="fu">nrow</span>(procurement_enriched) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Percentage of procurement records with financial grade information:"</span>, <span class="fu">round</span>(financial_grade_coverage, <span class="dv">2</span>), <span class="st">"%</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Percentage of procurement records with financial grade information: 64.35 %</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>missing_grade_by_size <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="at">is_grade_missing =</span> <span class="fu">is.na</span>(financial_grade)) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_contract_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_contract_value =</span> <span class="fu">median</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_records =</span> <span class="fu">n</span>() <span class="sc">/</span> <span class="fu">nrow</span>(procurement_enriched) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_of_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> <span class="fu">sum</span>(procurement_enriched<span class="sc">$</span>awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">*</span> <span class="dv">100</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(missing_grade_by_size)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 7
  is_grade_missing count  total_value avg_contract_value median_contract_value
  &lt;lgl&gt;            &lt;int&gt;        &lt;dbl&gt;              &lt;dbl&gt;                 &lt;dbl&gt;
1 FALSE            11994 31937582643.           2662797.               201464.
2 TRUE              6644 71313233781.          10733479.                90000 
# ℹ 2 more variables: pct_of_records &lt;dbl&gt;, pct_of_value &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="relationship-between-variables" class="level3">
<h3 class="anchored" data-anchor-id="relationship-between-variables">2.8 Relationship Between Variables</h3>
<p>Let’s see if there’s a relationship between award amount and number of contracts per supplier</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>supplier_counts <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">contract_count =</span> <span class="fu">n</span>(),</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">avg_value =</span> <span class="fu">mean</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(supplier_counts, <span class="fu">aes</span>(<span class="at">x =</span> contract_count, <span class="at">y =</span> avg_value)) <span class="sc">+</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_log10</span>() <span class="sc">+</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Relationship Between Number of Contracts and Average Value"</span>,</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Number of Contracts (Log Scale)"</span>,</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Average Contract Value (Log Scale)"</span>) <span class="sc">+</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Take-home_Ex3_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">3. Data Preprocessing</h2>
<section id="date-conversion-and-handling-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="date-conversion-and-handling-missing-values">3.1 Date Conversion and Handling Missing Values</h3>
<p>We’ll perform several preprocessing steps to improve data quality:</p>
<ol type="1">
<li>Convert date strings to proper Date objects</li>
<li>Create a year field for filtering</li>
<li>Handle missing values in supplier names</li>
<li>Create financial grade categories for visualization</li>
</ol>
<p>For the financial grades, we’ll consolidate the nine different S-grades (S2-S10) into three more manageable categories:</p>
<ul>
<li>Small (S1-S4): Suppliers with financial capacity up to $500,000</li>
<li>Medium (S5-S7): Suppliers with financial capacity between $1,000,000 and $5,000,000</li>
<li>Large (S8-S10): Suppliers with financial capacity of $10,000,000 and above</li>
</ul>
<p>These preprocessing steps ensure our data is clean, properly formatted, and appropriately categorized for visualization.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert award_date to proper date format</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">award_date =</span> <span class="fu">as.Date</span>(award_date, <span class="at">format=</span><span class="st">"%d/%m/%Y"</span>))</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a year field for filtering</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">year</span>(award_date))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Handle missing values in supplier_name</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">supplier_name =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(supplier_name) <span class="sc">|</span> supplier_name <span class="sc">==</span> <span class="st">"Unknown"</span>, <span class="st">"Unspecified Supplier"</span>, supplier_name))</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create financial grade categories for better visualization</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>procurement_enriched <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">financial_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>, <span class="st">"S4"</span>) <span class="sc">~</span> <span class="st">"Small (S1-S4)"</span>,</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S5"</span>, <span class="st">"S6"</span>, <span class="st">"S7"</span>) <span class="sc">~</span> <span class="st">"Medium (S5-S7)"</span>,</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S8"</span>, <span class="st">"S9"</span>, <span class="st">"S10"</span>) <span class="sc">~</span> <span class="st">"Large (S8-S10)"</span>,</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Unspecified Grade"</span></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the processed data</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(procurement_enriched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 18,638
Columns: 13
$ tender_no            &lt;chr&gt; "ACR000ETT18300010", "ACR000ETT18300011", "ACR000…
$ tender_description   &lt;chr&gt; "SUPPLY, DESIGN, DEVELOPMENT, CUSTOMIZATION, DELI…
$ agency               &lt;chr&gt; "Accounting And Corporate Regulatory Authority", …
$ award_date           &lt;date&gt; 2019-06-11, 2019-05-10, 2019-04-30, 2019-08-29, …
$ tender_detail_status &lt;chr&gt; "Awarded to Suppliers", "Awarded to No Suppliers"…
$ supplier_name        &lt;chr&gt; "AZAAS PTE. LTD.", "Unspecified Supplier", "ACCEN…
$ awarded_amt          &lt;dbl&gt; 2305880.0, 0.0, 2035000.0, 30700373.9, 178800.0, …
$ financial_grade      &lt;chr&gt; "S9", NA, "S10", "S10", NA, "S10", "S10", "S10", …
$ agency_abbr          &lt;chr&gt; "ACRA", "ACRA", "ACRA", "ACRA", "ACRA", "ACRA", "…
$ ministry             &lt;chr&gt; "MINISTRY OF FINANCE", "MINISTRY OF FINANCE", "MI…
$ ministry_abbr        &lt;chr&gt; "MOF", "MOF", "MOF", "MOF", "MOF", "MOF", "MOF", …
$ financial_category   &lt;chr&gt; "Large (S8-S10)", "Unspecified Grade", "Large (S8…
$ year                 &lt;dbl&gt; 2019, 2019, 2019, 2019, 2019, 2019, 2020, 2020, 2…</code></pre>
</div>
</div>
</section>
</section>
<section id="building-the-sankey-diagram-visualization" class="level2">
<h2 class="anchored" data-anchor-id="building-the-sankey-diagram-visualization">4. Building the Sankey Diagram Visualization</h2>
<p>The heart of our visualization is the create_sankey() function defined below. This function creates a Sankey diagram showing the flow of procurement funds from ministries to agencies to suppliers.</p>
<p>The function is highly customizable, allowing users to:</p>
<ul>
<li>Filter by year, ministry, agency, or supplier</li>
<li>Show only the top K ministries, agencies, or suppliers by procurement value</li>
<li>Set a minimum value threshold to include only significant flows</li>
<li>Enable debug mode for troubleshooting when developing the Shiny application</li>
</ul>
<p>This customizability makes the function valuable for exploring different aspects of the procurement network.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>create_sankey <span class="ot">&lt;-</span> <span class="cf">function</span>(data, </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                          <span class="at">year_filter =</span> <span class="cn">NULL</span>, </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ministry_filter =</span> <span class="cn">NULL</span>,</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">agency_filter =</span> <span class="cn">NULL</span>,</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">supplier_filter =</span> <span class="cn">NULL</span>,</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">top_k_ministries =</span> <span class="dv">10</span>,</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">top_k_agencies =</span> <span class="dv">10</span>,</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">top_k_suppliers =</span> <span class="dv">10</span>,</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">min_value =</span> <span class="dv">1000000</span>,</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">supplier_char_limit =</span> <span class="dv">50</span>,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>                          <span class="at">group_by_grade =</span> <span class="cn">FALSE</span>,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">debug =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Log data diagnostics if debug is enabled</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(debug) {</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Data dimensions: "</span>, <span class="fu">nrow</span>(data), <span class="st">" rows x "</span>, <span class="fu">ncol</span>(data), <span class="st">" columns"</span>)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"ministry"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(data)) {</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">message</span>(<span class="st">"Unique ministries: "</span>, <span class="fu">length</span>(<span class="fu">unique</span>(data<span class="sc">$</span>ministry)))</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(ministry_filter)) {</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">message</span>(<span class="st">"Checking for requested ministry: "</span>, </span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">ifelse</span>(<span class="fu">any</span>(ministry_filter <span class="sc">%in%</span> <span class="fu">unique</span>(data<span class="sc">$</span>ministry)), <span class="st">"Found"</span>, <span class="st">"Not found"</span>))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">"'ministry' column not found in data"</span>)</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Make a copy of the data</span></span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a>  filtered_data <span class="ot">&lt;-</span> data</span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply year filter if specified</span></span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(year_filter)) {</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="st">"year"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(filtered_data)) {</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>      filtered_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year <span class="sc">==</span> year_filter)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(debug) <span class="fu">message</span>(<span class="st">"After year filter: "</span>, <span class="fu">nrow</span>(filtered_data), <span class="st">" rows"</span>)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">warning</span>(<span class="st">"'year' column not found, skipping year filter"</span>)</span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-40"><a href="#cb42-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-41"><a href="#cb42-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 1. Determine which ministries to include</span></span>
<span id="cb42-42"><a href="#cb42-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(ministry_filter)) {</span>
<span id="cb42-43"><a href="#cb42-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the specified ministries</span></span>
<span id="cb42-44"><a href="#cb42-44" aria-hidden="true" tabindex="-1"></a>    ministries_to_include <span class="ot">&lt;-</span> ministry_filter</span>
<span id="cb42-45"><a href="#cb42-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-46"><a href="#cb42-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top ministries by award amount</span></span>
<span id="cb42-47"><a href="#cb42-47" aria-hidden="true" tabindex="-1"></a>    ministries_to_include <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-48"><a href="#cb42-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(ministry) <span class="sc">%&gt;%</span></span>
<span id="cb42-49"><a href="#cb42-49" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-50"><a href="#cb42-50" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb42-51"><a href="#cb42-51" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(top_k_ministries) <span class="sc">%&gt;%</span></span>
<span id="cb42-52"><a href="#cb42-52" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(ministry)</span>
<span id="cb42-53"><a href="#cb42-53" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-54"><a href="#cb42-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-55"><a href="#cb42-55" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 2. Determine which agencies to include</span></span>
<span id="cb42-56"><a href="#cb42-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(agency_filter)) {</span>
<span id="cb42-57"><a href="#cb42-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the specified agencies</span></span>
<span id="cb42-58"><a href="#cb42-58" aria-hidden="true" tabindex="-1"></a>    agencies_to_include <span class="ot">&lt;-</span> agency_filter</span>
<span id="cb42-59"><a href="#cb42-59" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-60"><a href="#cb42-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top agencies by award amount</span></span>
<span id="cb42-61"><a href="#cb42-61" aria-hidden="true" tabindex="-1"></a>    agencies_to_include <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-62"><a href="#cb42-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(ministry <span class="sc">%in%</span> ministries_to_include) <span class="sc">%&gt;%</span></span>
<span id="cb42-63"><a href="#cb42-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(agency) <span class="sc">%&gt;%</span></span>
<span id="cb42-64"><a href="#cb42-64" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-65"><a href="#cb42-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb42-66"><a href="#cb42-66" aria-hidden="true" tabindex="-1"></a>      <span class="fu">head</span>(top_k_agencies) <span class="sc">%&gt;%</span></span>
<span id="cb42-67"><a href="#cb42-67" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pull</span>(agency)</span>
<span id="cb42-68"><a href="#cb42-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-69"><a href="#cb42-69" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-70"><a href="#cb42-70" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 3. Determine which suppliers to include based on the view mode</span></span>
<span id="cb42-71"><a href="#cb42-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(supplier_filter)) {</span>
<span id="cb42-72"><a href="#cb42-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use the specified suppliers</span></span>
<span id="cb42-73"><a href="#cb42-73" aria-hidden="true" tabindex="-1"></a>    suppliers_to_include <span class="ot">&lt;-</span> supplier_filter</span>
<span id="cb42-74"><a href="#cb42-74" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-75"><a href="#cb42-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get top suppliers by award amount</span></span>
<span id="cb42-76"><a href="#cb42-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(group_by_grade) {</span>
<span id="cb42-77"><a href="#cb42-77" aria-hidden="true" tabindex="-1"></a>      <span class="co"># When grouping by grade, supplier categories will be the financial_category (e.g., "Large (S8-S10)")</span></span>
<span id="cb42-78"><a href="#cb42-78" aria-hidden="true" tabindex="-1"></a>      <span class="co"># We still need to filter by top suppliers for consistency, but we'll sum across all suppliers</span></span>
<span id="cb42-79"><a href="#cb42-79" aria-hidden="true" tabindex="-1"></a>      suppliers_to_include <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-80"><a href="#cb42-80" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(agency <span class="sc">%in%</span> agencies_to_include) <span class="sc">%&gt;%</span></span>
<span id="cb42-81"><a href="#cb42-81" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(financial_category) <span class="sc">%&gt;%</span></span>
<span id="cb42-82"><a href="#cb42-82" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-83"><a href="#cb42-83" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(financial_category)) <span class="sc">%&gt;%</span>  <span class="co"># Exclude NA categories</span></span>
<span id="cb42-84"><a href="#cb42-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb42-85"><a href="#cb42-85" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(top_k_suppliers) <span class="sc">%&gt;%</span></span>
<span id="cb42-86"><a href="#cb42-86" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(financial_category)</span>
<span id="cb42-87"><a href="#cb42-87" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb42-88"><a href="#cb42-88" aria-hidden="true" tabindex="-1"></a>      <span class="co"># When showing individual suppliers</span></span>
<span id="cb42-89"><a href="#cb42-89" aria-hidden="true" tabindex="-1"></a>      suppliers_to_include <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-90"><a href="#cb42-90" aria-hidden="true" tabindex="-1"></a>        <span class="fu">filter</span>(agency <span class="sc">%in%</span> agencies_to_include) <span class="sc">%&gt;%</span></span>
<span id="cb42-91"><a href="#cb42-91" aria-hidden="true" tabindex="-1"></a>        <span class="fu">group_by</span>(supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb42-92"><a href="#cb42-92" aria-hidden="true" tabindex="-1"></a>        <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb42-93"><a href="#cb42-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb42-94"><a href="#cb42-94" aria-hidden="true" tabindex="-1"></a>        <span class="fu">head</span>(top_k_suppliers) <span class="sc">%&gt;%</span></span>
<span id="cb42-95"><a href="#cb42-95" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pull</span>(supplier_name)</span>
<span id="cb42-96"><a href="#cb42-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb42-97"><a href="#cb42-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-98"><a href="#cb42-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-99"><a href="#cb42-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(debug) {</span>
<span id="cb42-100"><a href="#cb42-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Ministries to include: "</span>, <span class="fu">length</span>(ministries_to_include))</span>
<span id="cb42-101"><a href="#cb42-101" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Agencies to include: "</span>, <span class="fu">length</span>(agencies_to_include))</span>
<span id="cb42-102"><a href="#cb42-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Suppliers to include: "</span>, <span class="fu">length</span>(suppliers_to_include))</span>
<span id="cb42-103"><a href="#cb42-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-104"><a href="#cb42-104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-105"><a href="#cb42-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter the data to only include the selected entities</span></span>
<span id="cb42-106"><a href="#cb42-106" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(group_by_grade) {</span>
<span id="cb42-107"><a href="#cb42-107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># When grouping by grade, filter by financial_category</span></span>
<span id="cb42-108"><a href="#cb42-108" aria-hidden="true" tabindex="-1"></a>    filtered_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-109"><a href="#cb42-109" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb42-110"><a href="#cb42-110" aria-hidden="true" tabindex="-1"></a>        ministry <span class="sc">%in%</span> ministries_to_include,</span>
<span id="cb42-111"><a href="#cb42-111" aria-hidden="true" tabindex="-1"></a>        agency <span class="sc">%in%</span> agencies_to_include,</span>
<span id="cb42-112"><a href="#cb42-112" aria-hidden="true" tabindex="-1"></a>        financial_category <span class="sc">%in%</span> suppliers_to_include</span>
<span id="cb42-113"><a href="#cb42-113" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-114"><a href="#cb42-114" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-115"><a href="#cb42-115" aria-hidden="true" tabindex="-1"></a>    <span class="co"># When showing individual suppliers, filter by supplier_name</span></span>
<span id="cb42-116"><a href="#cb42-116" aria-hidden="true" tabindex="-1"></a>    filtered_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-117"><a href="#cb42-117" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(</span>
<span id="cb42-118"><a href="#cb42-118" aria-hidden="true" tabindex="-1"></a>        ministry <span class="sc">%in%</span> ministries_to_include,</span>
<span id="cb42-119"><a href="#cb42-119" aria-hidden="true" tabindex="-1"></a>        agency <span class="sc">%in%</span> agencies_to_include,</span>
<span id="cb42-120"><a href="#cb42-120" aria-hidden="true" tabindex="-1"></a>        supplier_name <span class="sc">%in%</span> suppliers_to_include</span>
<span id="cb42-121"><a href="#cb42-121" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb42-122"><a href="#cb42-122" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-123"><a href="#cb42-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-124"><a href="#cb42-124" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(debug) <span class="fu">message</span>(<span class="st">"After entity filtering: "</span>, <span class="fu">nrow</span>(filtered_data), <span class="st">" rows"</span>)</span>
<span id="cb42-125"><a href="#cb42-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-126"><a href="#cb42-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if we have any data left</span></span>
<span id="cb42-127"><a href="#cb42-127" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(filtered_data) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb42-128"><a href="#cb42-128" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No data remains after filtering"</span>)</span>
<span id="cb42-129"><a href="#cb42-129" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb42-130"><a href="#cb42-130" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-131"><a href="#cb42-131" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-132"><a href="#cb42-132" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create ministry-to-agency flow</span></span>
<span id="cb42-133"><a href="#cb42-133" aria-hidden="true" tabindex="-1"></a>  ministry_agency_flow <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-134"><a href="#cb42-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(ministry, agency) <span class="sc">%&gt;%</span></span>
<span id="cb42-135"><a href="#cb42-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-136"><a href="#cb42-136" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(value <span class="sc">&gt;=</span> min_value)</span>
<span id="cb42-137"><a href="#cb42-137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-138"><a href="#cb42-138" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create agency-to-supplier flow based on the view mode</span></span>
<span id="cb42-139"><a href="#cb42-139" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(group_by_grade) {</span>
<span id="cb42-140"><a href="#cb42-140" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by financial_category (S-grades)</span></span>
<span id="cb42-141"><a href="#cb42-141" aria-hidden="true" tabindex="-1"></a>    agency_supplier_flow <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-142"><a href="#cb42-142" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(agency, financial_category) <span class="sc">%&gt;%</span></span>
<span id="cb42-143"><a href="#cb42-143" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-144"><a href="#cb42-144" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(value <span class="sc">&gt;=</span> min_value) <span class="sc">%&gt;%</span></span>
<span id="cb42-145"><a href="#cb42-145" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">supplier_name =</span> financial_category)</span>
<span id="cb42-146"><a href="#cb42-146" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb42-147"><a href="#cb42-147" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Group by individual supplier_name</span></span>
<span id="cb42-148"><a href="#cb42-148" aria-hidden="true" tabindex="-1"></a>    agency_supplier_flow <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb42-149"><a href="#cb42-149" aria-hidden="true" tabindex="-1"></a>      <span class="fu">group_by</span>(agency, supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb42-150"><a href="#cb42-150" aria-hidden="true" tabindex="-1"></a>      <span class="fu">summarize</span>(<span class="at">value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">.groups =</span> <span class="st">'drop'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-151"><a href="#cb42-151" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(value <span class="sc">&gt;=</span> min_value)</span>
<span id="cb42-152"><a href="#cb42-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-153"><a href="#cb42-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-154"><a href="#cb42-154" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(debug) {</span>
<span id="cb42-155"><a href="#cb42-155" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Ministry-agency flows: "</span>, <span class="fu">nrow</span>(ministry_agency_flow))</span>
<span id="cb42-156"><a href="#cb42-156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">"Agency-supplier flows: "</span>, <span class="fu">nrow</span>(agency_supplier_flow))</span>
<span id="cb42-157"><a href="#cb42-157" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-158"><a href="#cb42-158" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-159"><a href="#cb42-159" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if we have any flows above the minimum value</span></span>
<span id="cb42-160"><a href="#cb42-160" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(ministry_agency_flow) <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(agency_supplier_flow) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb42-161"><a href="#cb42-161" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No flows remain after applying minimum value filter ("</span>, </span>
<span id="cb42-162"><a href="#cb42-162" aria-hidden="true" tabindex="-1"></a>            min_value, <span class="st">")"</span>)</span>
<span id="cb42-163"><a href="#cb42-163" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb42-164"><a href="#cb42-164" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-165"><a href="#cb42-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-166"><a href="#cb42-166" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get unique lists of each entity type</span></span>
<span id="cb42-167"><a href="#cb42-167" aria-hidden="true" tabindex="-1"></a>  ministry_nodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(ministry_agency_flow<span class="sc">$</span>ministry)</span>
<span id="cb42-168"><a href="#cb42-168" aria-hidden="true" tabindex="-1"></a>  agency_nodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">c</span>(ministry_agency_flow<span class="sc">$</span>agency, agency_supplier_flow<span class="sc">$</span>agency))</span>
<span id="cb42-169"><a href="#cb42-169" aria-hidden="true" tabindex="-1"></a>  supplier_nodes <span class="ot">&lt;-</span> <span class="fu">unique</span>(agency_supplier_flow<span class="sc">$</span>supplier_name)</span>
<span id="cb42-170"><a href="#cb42-170" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-171"><a href="#cb42-171" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame to hold both display names and full names for tooltips</span></span>
<span id="cb42-172"><a href="#cb42-172" aria-hidden="true" tabindex="-1"></a>  nodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-173"><a href="#cb42-173" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="fu">character</span>(),        <span class="co"># Full name</span></span>
<span id="cb42-174"><a href="#cb42-174" aria-hidden="true" tabindex="-1"></a>    <span class="at">display_name =</span> <span class="fu">character</span>(),  <span class="co"># Display name (full name for ministry/agency)</span></span>
<span id="cb42-175"><a href="#cb42-175" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">character</span>(),       <span class="co"># Node type</span></span>
<span id="cb42-176"><a href="#cb42-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb42-177"><a href="#cb42-177" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-178"><a href="#cb42-178" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-179"><a href="#cb42-179" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add ministries with full name</span></span>
<span id="cb42-180"><a href="#cb42-180" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (ministry <span class="cf">in</span> ministry_nodes) {</span>
<span id="cb42-181"><a href="#cb42-181" aria-hidden="true" tabindex="-1"></a>    display <span class="ot">&lt;-</span> ministry</span>
<span id="cb42-182"><a href="#cb42-182" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-183"><a href="#cb42-183" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nodes, <span class="fu">data.frame</span>(</span>
<span id="cb42-184"><a href="#cb42-184" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> ministry,</span>
<span id="cb42-185"><a href="#cb42-185" aria-hidden="true" tabindex="-1"></a>      <span class="at">display_name =</span> display,</span>
<span id="cb42-186"><a href="#cb42-186" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="st">"ministry"</span>,</span>
<span id="cb42-187"><a href="#cb42-187" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb42-188"><a href="#cb42-188" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb42-189"><a href="#cb42-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-190"><a href="#cb42-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-191"><a href="#cb42-191" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add agencies with full name</span></span>
<span id="cb42-192"><a href="#cb42-192" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (agency <span class="cf">in</span> agency_nodes) {</span>
<span id="cb42-193"><a href="#cb42-193" aria-hidden="true" tabindex="-1"></a>    display <span class="ot">&lt;-</span> agency</span>
<span id="cb42-194"><a href="#cb42-194" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-195"><a href="#cb42-195" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nodes, <span class="fu">data.frame</span>(</span>
<span id="cb42-196"><a href="#cb42-196" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> agency,</span>
<span id="cb42-197"><a href="#cb42-197" aria-hidden="true" tabindex="-1"></a>      <span class="at">display_name =</span> display,</span>
<span id="cb42-198"><a href="#cb42-198" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="st">"agency"</span>,</span>
<span id="cb42-199"><a href="#cb42-199" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb42-200"><a href="#cb42-200" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb42-201"><a href="#cb42-201" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-202"><a href="#cb42-202" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-203"><a href="#cb42-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add suppliers with truncation if needed</span></span>
<span id="cb42-204"><a href="#cb42-204" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (supplier <span class="cf">in</span> supplier_nodes) {</span>
<span id="cb42-205"><a href="#cb42-205" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Truncate long supplier names based on the supplier_char_limit parameter</span></span>
<span id="cb42-206"><a href="#cb42-206" aria-hidden="true" tabindex="-1"></a>    display <span class="ot">&lt;-</span> <span class="cf">if</span>(<span class="fu">nchar</span>(supplier) <span class="sc">&gt;</span> supplier_char_limit) </span>
<span id="cb42-207"><a href="#cb42-207" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste0</span>(<span class="fu">substr</span>(supplier, <span class="dv">1</span>, supplier_char_limit <span class="sc">-</span> <span class="dv">3</span>), <span class="st">"..."</span>) </span>
<span id="cb42-208"><a href="#cb42-208" aria-hidden="true" tabindex="-1"></a>               <span class="cf">else</span> </span>
<span id="cb42-209"><a href="#cb42-209" aria-hidden="true" tabindex="-1"></a>                 supplier</span>
<span id="cb42-210"><a href="#cb42-210" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb42-211"><a href="#cb42-211" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">&lt;-</span> <span class="fu">rbind</span>(nodes, <span class="fu">data.frame</span>(</span>
<span id="cb42-212"><a href="#cb42-212" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> supplier,</span>
<span id="cb42-213"><a href="#cb42-213" aria-hidden="true" tabindex="-1"></a>      <span class="at">display_name =</span> display,</span>
<span id="cb42-214"><a href="#cb42-214" aria-hidden="true" tabindex="-1"></a>      <span class="at">group =</span> <span class="st">"supplier"</span>,</span>
<span id="cb42-215"><a href="#cb42-215" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb42-216"><a href="#cb42-216" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb42-217"><a href="#cb42-217" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-218"><a href="#cb42-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-219"><a href="#cb42-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the indices of each node</span></span>
<span id="cb42-220"><a href="#cb42-220" aria-hidden="true" tabindex="-1"></a>  node_indices <span class="ot">&lt;-</span> <span class="fu">setNames</span>(<span class="dv">0</span><span class="sc">:</span>(<span class="fu">nrow</span>(nodes)<span class="sc">-</span><span class="dv">1</span>), nodes<span class="sc">$</span>name)</span>
<span id="cb42-221"><a href="#cb42-221" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-222"><a href="#cb42-222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the ministry to agency links</span></span>
<span id="cb42-223"><a href="#cb42-223" aria-hidden="true" tabindex="-1"></a>  links_m2a <span class="ot">&lt;-</span> ministry_agency_flow <span class="sc">%&gt;%</span></span>
<span id="cb42-224"><a href="#cb42-224" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-225"><a href="#cb42-225" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> node_indices[ministry],</span>
<span id="cb42-226"><a href="#cb42-226" aria-hidden="true" tabindex="-1"></a>      <span class="at">target =</span> node_indices[agency]</span>
<span id="cb42-227"><a href="#cb42-227" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb42-228"><a href="#cb42-228" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(source, target, value)</span>
<span id="cb42-229"><a href="#cb42-229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-230"><a href="#cb42-230" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create the agency to supplier links</span></span>
<span id="cb42-231"><a href="#cb42-231" aria-hidden="true" tabindex="-1"></a>  links_a2s <span class="ot">&lt;-</span> agency_supplier_flow <span class="sc">%&gt;%</span></span>
<span id="cb42-232"><a href="#cb42-232" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb42-233"><a href="#cb42-233" aria-hidden="true" tabindex="-1"></a>      <span class="at">source =</span> node_indices[agency],</span>
<span id="cb42-234"><a href="#cb42-234" aria-hidden="true" tabindex="-1"></a>      <span class="at">target =</span> node_indices[supplier_name]</span>
<span id="cb42-235"><a href="#cb42-235" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb42-236"><a href="#cb42-236" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(source, target, value)</span>
<span id="cb42-237"><a href="#cb42-237" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-238"><a href="#cb42-238" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all links</span></span>
<span id="cb42-239"><a href="#cb42-239" aria-hidden="true" tabindex="-1"></a>  links <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(links_m2a, links_a2s)</span>
<span id="cb42-240"><a href="#cb42-240" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-241"><a href="#cb42-241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if we have any links</span></span>
<span id="cb42-242"><a href="#cb42-242" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(links) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb42-243"><a href="#cb42-243" aria-hidden="true" tabindex="-1"></a>    <span class="fu">warning</span>(<span class="st">"No links could be created"</span>)</span>
<span id="cb42-244"><a href="#cb42-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb42-245"><a href="#cb42-245" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb42-246"><a href="#cb42-246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-247"><a href="#cb42-247" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create Sankey diagram</span></span>
<span id="cb42-248"><a href="#cb42-248" aria-hidden="true" tabindex="-1"></a>  sankey <span class="ot">&lt;-</span> <span class="fu">sankeyNetwork</span>(</span>
<span id="cb42-249"><a href="#cb42-249" aria-hidden="true" tabindex="-1"></a>    <span class="at">Links =</span> links, </span>
<span id="cb42-250"><a href="#cb42-250" aria-hidden="true" tabindex="-1"></a>    <span class="at">Nodes =</span> nodes, </span>
<span id="cb42-251"><a href="#cb42-251" aria-hidden="true" tabindex="-1"></a>    <span class="at">Source =</span> <span class="st">"source"</span>, </span>
<span id="cb42-252"><a href="#cb42-252" aria-hidden="true" tabindex="-1"></a>    <span class="at">Target =</span> <span class="st">"target"</span>, </span>
<span id="cb42-253"><a href="#cb42-253" aria-hidden="true" tabindex="-1"></a>    <span class="at">Value =</span> <span class="st">"value"</span>, </span>
<span id="cb42-254"><a href="#cb42-254" aria-hidden="true" tabindex="-1"></a>    <span class="at">NodeID =</span> <span class="st">"display_name"</span>,</span>
<span id="cb42-255"><a href="#cb42-255" aria-hidden="true" tabindex="-1"></a>    <span class="at">NodeGroup =</span> <span class="st">"group"</span>,</span>
<span id="cb42-256"><a href="#cb42-256" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Custom color scheme</span></span>
<span id="cb42-257"><a href="#cb42-257" aria-hidden="true" tabindex="-1"></a>    <span class="at">colourScale =</span> <span class="fu">JS</span>(<span class="st">'d3.scaleOrdinal()</span></span>
<span id="cb42-258"><a href="#cb42-258" aria-hidden="true" tabindex="-1"></a><span class="st">                     .domain(["ministry", "agency", "supplier"])</span></span>
<span id="cb42-259"><a href="#cb42-259" aria-hidden="true" tabindex="-1"></a><span class="st">                     .range(["#1f77b4", "#ff7f0e", "#2ca02c"])'</span>),</span>
<span id="cb42-260"><a href="#cb42-260" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Layout parameters</span></span>
<span id="cb42-261"><a href="#cb42-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodeWidth =</span> <span class="dv">30</span>,</span>
<span id="cb42-262"><a href="#cb42-262" aria-hidden="true" tabindex="-1"></a>    <span class="at">nodePadding =</span> <span class="dv">20</span>,</span>
<span id="cb42-263"><a href="#cb42-263" aria-hidden="true" tabindex="-1"></a>    <span class="at">margin =</span> <span class="fu">list</span>(<span class="at">top =</span> <span class="dv">30</span>, <span class="at">right =</span> <span class="dv">30</span>, <span class="at">bottom =</span> <span class="dv">30</span>, <span class="at">left =</span> <span class="dv">30</span>),</span>
<span id="cb42-264"><a href="#cb42-264" aria-hidden="true" tabindex="-1"></a>    <span class="at">sinksRight =</span> <span class="cn">TRUE</span>,</span>
<span id="cb42-265"><a href="#cb42-265" aria-hidden="true" tabindex="-1"></a>    <span class="at">fontSize =</span> <span class="dv">11</span>,</span>
<span id="cb42-266"><a href="#cb42-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">800</span>,</span>
<span id="cb42-267"><a href="#cb42-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">1200</span>,</span>
<span id="cb42-268"><a href="#cb42-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">iterations =</span> <span class="dv">64</span>  <span class="co"># More iterations for better layout</span></span>
<span id="cb42-269"><a href="#cb42-269" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-270"><a href="#cb42-270" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-271"><a href="#cb42-271" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add JavaScript for better rendering and tooltip formatting</span></span>
<span id="cb42-272"><a href="#cb42-272" aria-hidden="true" tabindex="-1"></a>  sankey <span class="ot">&lt;-</span> htmlwidgets<span class="sc">::</span><span class="fu">onRender</span>(</span>
<span id="cb42-273"><a href="#cb42-273" aria-hidden="true" tabindex="-1"></a>    sankey,</span>
<span id="cb42-274"><a href="#cb42-274" aria-hidden="true" tabindex="-1"></a>    <span class="st">'</span></span>
<span id="cb42-275"><a href="#cb42-275" aria-hidden="true" tabindex="-1"></a><span class="st">    function(el, x) {</span></span>
<span id="cb42-276"><a href="#cb42-276" aria-hidden="true" tabindex="-1"></a><span class="st">      // Ensure diagram is properly sized</span></span>
<span id="cb42-277"><a href="#cb42-277" aria-hidden="true" tabindex="-1"></a><span class="st">      d3.select(el).select("svg")</span></span>
<span id="cb42-278"><a href="#cb42-278" aria-hidden="true" tabindex="-1"></a><span class="st">        .attr("viewBox", "0 0 1200 800")</span></span>
<span id="cb42-279"><a href="#cb42-279" aria-hidden="true" tabindex="-1"></a><span class="st">        .attr("preserveAspectRatio", "xMidYMid meet");</span></span>
<span id="cb42-280"><a href="#cb42-280" aria-hidden="true" tabindex="-1"></a><span class="st">        </span></span>
<span id="cb42-281"><a href="#cb42-281" aria-hidden="true" tabindex="-1"></a><span class="st">      // Add formatted tooltips to links</span></span>
<span id="cb42-282"><a href="#cb42-282" aria-hidden="true" tabindex="-1"></a><span class="st">      d3.select(el).selectAll(".link")</span></span>
<span id="cb42-283"><a href="#cb42-283" aria-hidden="true" tabindex="-1"></a><span class="st">        .append("title")</span></span>
<span id="cb42-284"><a href="#cb42-284" aria-hidden="true" tabindex="-1"></a><span class="st">        .text(function(d) { </span></span>
<span id="cb42-285"><a href="#cb42-285" aria-hidden="true" tabindex="-1"></a><span class="st">          return d.source.name + " → " + d.target.name + </span></span>
<span id="cb42-286"><a href="#cb42-286" aria-hidden="true" tabindex="-1"></a><span class="st">                 "</span><span class="sc">\\</span><span class="st">nValue: $" + d3.format(",.0f")(d.value); </span></span>
<span id="cb42-287"><a href="#cb42-287" aria-hidden="true" tabindex="-1"></a><span class="st">        });</span></span>
<span id="cb42-288"><a href="#cb42-288" aria-hidden="true" tabindex="-1"></a><span class="st">    }</span></span>
<span id="cb42-289"><a href="#cb42-289" aria-hidden="true" tabindex="-1"></a><span class="st">    '</span></span>
<span id="cb42-290"><a href="#cb42-290" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-291"><a href="#cb42-291" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb42-292"><a href="#cb42-292" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sankey)</span>
<span id="cb42-293"><a href="#cb42-293" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>create_sankey()</code> function is highly customizable through various parameters that control filtering, display options, and performance.</p>
<p>Filtering parameters:</p>
<ul>
<li><code>year_filter</code>: Numeric or NULL. Filter records by a specific year (e.g., 2023). If NULL (default), all years are included.</li>
<li><code>ministry_filter</code>: Character vector or NULL. Filter by specific ministry names. If NULL (default), top ministries are selected based on top_k_ministries.</li>
<li><code>agency_filter</code>: Character vector or NULL. Filter by specific agency names. If NULL (default), top agencies are selected based on <code>top_k_agencies</code>.</li>
<li><code>supplier_filter</code>: Character vector or NULL. Filter by specific supplier names or categories (depending on <code>group_by_grade</code>). If NULL (default), top suppliers are selected based on <code>top_k_suppliers</code>.</li>
</ul>
<p>Top-k selection parameters:</p>
<ul>
<li><code>top_k_ministries</code>: Numeric, default 10. When no ministry filter is provided, specifies how many top ministries to include, ranked by total procurement value.</li>
<li><code>top_k_agencies</code>: Numeric, default 10. When no agency filter is provided, specifies how many top agencies to include, ranked by total procurement value.</li>
<li><code>top_k_suppliers</code>: Numeric, default 10. When no supplier filter is provided, specifies how many top suppliers or categories to include, ranked by total procurement value.</li>
</ul>
<p>Other parameters:</p>
<ul>
<li><p><code>min_value</code>: Numeric, default 1,000,000. Minimum threshold value for flows to be included in the diagram. Flows with values below this threshold are excluded, helping to simplify complex diagrams.</p></li>
<li><p><code>supplier_char_limit</code>: Numeric, default 50. Maximum number of characters to display for supplier names. Longer names are truncated with “…”.</p></li>
<li><p><code>group_by_grade</code>: Logical, default FALSE. Controls whether suppliers are grouped by financial grade categories (TRUE) or shown as individual suppliers (FALSE).</p></li>
<li><p><code>debug</code>: Logical, default FALSE. When TRUE, prints diagnostic messages during function execution to help troubleshoot issues.</p></li>
</ul>
</section>
<section id="creating-sankey-visualization-examples" class="level2">
<h2 class="anchored" data-anchor-id="creating-sankey-visualization-examples">5. Creating Sankey Visualization Examples</h2>
<p>This section presents several Sankey diagram visualizations that demonstrate different perspectives on the GeBiz procurement data. Each visualization highlights specific patterns and relationships within the procurement network, helping stakeholders understand how government funds flow from ministries to agencies to suppliers.</p>
<section id="filtering-by-ministry" class="level3">
<h3 class="anchored" data-anchor-id="filtering-by-ministry">5.1 Filtering by Ministry</h3>
<p>This visualization focuses on the Ministry of Education’s procurement flows, revealing how education funding distributes across agencies and suppliers. It highlights the ministry’s key procurement channels and major supplier relationships.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram for Ministry of Education</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>moe_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_filter =</span> <span class="dv">2023</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">ministry_filter =</span> <span class="fu">c</span>(<span class="st">"MINISTRY OF EDUCATION"</span>),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">1000000</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_agencies =</span> <span class="dv">100</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_suppliers =</span> <span class="dv">20</span>,</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">supplier_char_limit =</span> <span class="dv">30</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the widget to an HTML file</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(moe_sankey, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"sankey_moe_"</span>, <span class="dv">2023</span>, <span class="st">".html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_moe_2023.html" width="100%" height="600px" frameborder="0"></iframe>
<p>The second visualization compares the Ministry of Health and Ministry of Education, with suppliers grouped by financial grade. This comparison reveals differences in agency structures, supplier profiles, and procurement value distributions between these major ministries.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram comparing two major ministries</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>health_defence_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_filter =</span> <span class="dv">2023</span>,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">ministry_filter =</span> <span class="fu">c</span>(<span class="st">"MINISTRY OF HEALTH"</span>, <span class="st">"MINISTRY OF EDUCATION"</span>),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">5000000</span>,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_agencies =</span> <span class="dv">10</span>, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_suppliers =</span> <span class="dv">15</span>,  </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_by_grade =</span> <span class="cn">TRUE</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(health_defence_sankey, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"sankey_health_education_"</span>, <span class="dv">2023</span>, <span class="st">".html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_health_education_2023.html" width="100%" height="600px" frameborder="0"></iframe>
</section>
<section id="filtering-by-agency" class="level3">
<h3 class="anchored" data-anchor-id="filtering-by-agency">5.2 Filtering by Agency</h3>
<p>This Sankey diagram examines the Land Transport Authority’s procurement patterns, showing its ministry connection and how its funds flow to suppliers of varying financial capacities. This view helps understand procurement strategies within key infrastructure agencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram for Land Transport Authority</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>lta_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_filter =</span> <span class="dv">2023</span>,</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">agency_filter =</span> <span class="fu">c</span>(<span class="st">"Land Transport Authority"</span>),</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">500000</span>, </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_suppliers =</span> <span class="dv">25</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(lta_sankey, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"sankey_lta_"</span>, <span class="dv">2023</span>, <span class="st">".html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_lta_2023.html" width="100%" height="600px" frameborder="0"></iframe>
</section>
<section id="filtering-by-suppliers" class="level3">
<h3 class="anchored" data-anchor-id="filtering-by-suppliers">5.3 Filtering by Suppliers</h3>
<section id="large-suppliers-analysis" class="level4">
<h4 class="anchored" data-anchor-id="large-suppliers-analysis">Large Suppliers Analysis</h4>
<p>This visualization focuses on the largest suppliers (S8-S10 financial grades) to understand how government procurement from major companies flows through different ministries and agencies. This perspective helps identify which large suppliers are receiving significant government contracts and through which channels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify top 10 suppliers by total contract value</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>top_suppliers <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(supplier_name)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram for top suppliers</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>top_suppliers_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">supplier_filter =</span> top_suppliers,</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">500000</span>, </span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_ministries =</span> <span class="dv">15</span>,</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_agencies =</span> <span class="dv">25</span>,   </span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">debug =</span> <span class="cn">FALSE</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(top_suppliers_sankey, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"sankey_top_suppliers_"</span>, <span class="dv">2023</span>, <span class="st">".html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_top_suppliers_2023.html" width="100%" height="600px" frameborder="0"></iframe>
</section>
<section id="sme-suppliers-analysis" class="level4">
<h4 class="anchored" data-anchor-id="sme-suppliers-analysis">SME Suppliers Analysis</h4>
<p>This view highlights Small and Medium Enterprise suppliers (S2-S7 financial grades), showing which ministries and agencies engage more with smaller businesses. The analysis supports policy objectives related to SME participation in government procurement.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get small-medium sized suppliers (those with lower financial grades)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>sme_suppliers <span class="ot">&lt;-</span> procurement_enriched <span class="sc">%&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(financial_grade <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"S2"</span>, <span class="st">"S3"</span>, <span class="st">"S4"</span>, <span class="st">"S5"</span>, <span class="st">"S6"</span>, <span class="st">"S7"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(supplier_name) <span class="sc">%&gt;%</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_value =</span> <span class="fu">sum</span>(awarded_amt, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(total_value)) <span class="sc">%&gt;%</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">15</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(supplier_name)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram for SME suppliers</span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>sme_suppliers_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Consider removing the year filter to see all data for these suppliers</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># year_filter = 2023,  </span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">supplier_filter =</span> sme_suppliers,</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">100000</span>,   <span class="co"># Lower threshold for SMEs</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_ministries =</span> <span class="dv">10</span>,  <span class="co"># Show up to 10 ministries</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_agencies =</span> <span class="dv">20</span>,</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_by_grade =</span> <span class="cn">FALSE</span></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(sme_suppliers_sankey, <span class="at">file =</span> <span class="fu">paste0</span>(<span class="st">"sankey_sme_suppliers_"</span>, <span class="dv">2023</span>, <span class="st">".html"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_sme_suppliers_2023.html" width="100%" height="600px" frameborder="0"></iframe>
</section>
</section>
<section id="top-k-analysis" class="level3">
<h3 class="anchored" data-anchor-id="top-k-analysis">5.4 Top K Analysis</h3>
<p>This visualization presents the most significant procurement flows across the entire government for 2023. It quickly identifies the dominant ministries, key agencies, and major suppliers by procurement value, providing a strategic overview of government spending patterns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Sankey diagram showing top entities across all dimensions</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>top_k_sankey <span class="ot">&lt;-</span> <span class="fu">create_sankey</span>(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> procurement_enriched,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_filter =</span> <span class="dv">2023</span>,</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_ministries =</span> <span class="dv">5</span>,  </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_agencies =</span> <span class="dv">10</span>, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">top_k_suppliers =</span> <span class="dv">20</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_value =</span> <span class="dv">500000</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="fu">saveNetwork</span>(top_k_sankey, <span class="at">file =</span> <span class="st">"sankey_top_k_2023.html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<iframe src="sankey_top_k_2023.html" width="100%" height="600px" frameborder="0"></iframe>
</section>
</section>
<section id="ui-design-for-interactive-dashboard" class="level2">
<h2 class="anchored" data-anchor-id="ui-design-for-interactive-dashboard">6. UI Design for Interactive Dashboard</h2>
<p>This section outlines the user interface design for the proposed GeBiz Procurement Data Visualization dashboard. The interactive dashboard will allow users to explore procurement data through various filters and visualization options.</p>
<section id="dashboard-layout" class="level3">
<h3 class="anchored" data-anchor-id="dashboard-layout">6.1 Dashboard Layout</h3>
<p>The dashboard will follow a three-panel layout design:</p>
<ol type="1">
<li><strong>Control Panel (Left)</strong>: Contains all filtering and customization options</li>
<li><strong>Visualization Area (Center)</strong>: Displays the selected Sankey diagram or other visualizations</li>
<li><strong>Information Panel (Right)</strong>: Shows additional context, metrics, and details about selected elements</li>
</ol>
<p>This layout ensures that users can easily navigate between different views while maintaining context.</p>
</section>
<section id="control-panel-components" class="level3">
<h3 class="anchored" data-anchor-id="control-panel-components">6.2 Control Panel Components</h3>
<p>The control panel will include the following UI components:</p>
<section id="date-range-selector" class="level4">
<h4 class="anchored" data-anchor-id="date-range-selector">6.2.1 Date Range Selector</h4>
<ul>
<li><strong>Type</strong>: Slider or dropdown</li>
<li><strong>Function</strong>: Allows users to filter data by year (2019-2023)</li>
<li><strong>Default</strong>: Most recent complete year</li>
</ul>
</section>
<section id="entity-type-selectors" class="level4">
<h4 class="anchored" data-anchor-id="entity-type-selectors">6.2.2 Entity Type Selectors</h4>
<ul>
<li><strong>Type</strong>: Tabbed interface with three tabs (Ministry, Agency, Supplier)</li>
<li><strong>Function</strong>: Determines the main focus of the analysis</li>
<li><strong>Default</strong>: Ministry view</li>
</ul>
</section>
<section id="entity-selection" class="level4">
<h4 class="anchored" data-anchor-id="entity-selection">6.2.3 Entity Selection</h4>
<ul>
<li><strong>Type</strong>: Searchable multi-select dropdown</li>
<li><strong>Function</strong>: Allows selection of specific ministries, agencies, or suppliers</li>
<li><strong>Features</strong>: Includes autocomplete and “Select Top K” options</li>
</ul>
</section>
<section id="visualization-controls" class="level4">
<h4 class="anchored" data-anchor-id="visualization-controls">6.2.4 Visualization Controls</h4>
<ul>
<li><strong>Type</strong>: Radio buttons and sliders</li>
<li><strong>Functions</strong>:
<ul>
<li>Toggle between individual suppliers and supplier groups (by financial grade)</li>
<li>Adjust minimum flow value threshold</li>
<li>Set “Top K” limits for ministries, agencies, and suppliers</li>
<li>Customize node display options (abbreviations vs.&nbsp;full names)</li>
</ul></li>
</ul>
</section>
<section id="export-and-share-options" class="level4">
<h4 class="anchored" data-anchor-id="export-and-share-options">6.2.5 Export and Share Options</h4>
<ul>
<li><strong>Type</strong>: Button group</li>
<li><strong>Functions</strong>: Save visualization as PNG/PDF, share link, download data</li>
</ul>
</section>
</section>
<section id="visualization-area-components" class="level3">
<h3 class="anchored" data-anchor-id="visualization-area-components">6.3 Visualization Area Components</h3>
<section id="sankey-diagram" class="level4">
<h4 class="anchored" data-anchor-id="sankey-diagram">6.3.1 Sankey Diagram</h4>
<ul>
<li><strong>Type</strong>: Interactive SVG</li>
<li><strong>Features</strong>:
<ul>
<li>Zoom and pan controls</li>
<li>Node dragging for better arrangement</li>
<li>Hover tooltips showing detailed information</li>
<li>Click interaction to highlight related flows</li>
<li>Animation during transitions between different views</li>
</ul></li>
</ul>
</section>
<section id="alternative-visualizations" class="level4">
<h4 class="anchored" data-anchor-id="alternative-visualizations">6.3.2 Alternative Visualizations</h4>
<ul>
<li><strong>Type</strong>: Tabbed interface</li>
<li><strong>Options</strong>:
<ul>
<li>Sankey Diagram (default)</li>
<li>Network Graph</li>
<li>Treemap</li>
<li>Bar Charts (for comparative analysis)</li>
</ul></li>
</ul>
</section>
</section>
<section id="information-panel-components" class="level3">
<h3 class="anchored" data-anchor-id="information-panel-components">6.4 Information Panel Components</h3>
<section id="selection-details" class="level4">
<h4 class="anchored" data-anchor-id="selection-details">6.4.1 Selection Details</h4>
<ul>
<li><strong>Type</strong>: Dynamic information cards</li>
<li><strong>Content</strong>: Detailed information about selected ministries, agencies, or suppliers</li>
<li><strong>Features</strong>: Updates when users click on nodes in the visualization</li>
</ul>
</section>
<section id="summary-metrics" class="level4">
<h4 class="anchored" data-anchor-id="summary-metrics">6.4.2 Summary Metrics</h4>
<ul>
<li><strong>Type</strong>: Key performance indicators (KPIs)</li>
<li><strong>Content</strong>:
<ul>
<li>Total procurement value</li>
<li>Number of contracts</li>
<li>Average contract value</li>
<li>Supplier diversity metrics</li>
</ul></li>
</ul>
</section>
<section id="trend-analysis" class="level4">
<h4 class="anchored" data-anchor-id="trend-analysis">6.4.3 Trend Analysis</h4>
<ul>
<li><strong>Type</strong>: Small multiple charts</li>
<li><strong>Content</strong>: Time series showing procurement patterns for selected entities</li>
</ul>
</section>
</section>
<section id="interactive-features" class="level3">
<h3 class="anchored" data-anchor-id="interactive-features">6.5 Interactive Features</h3>
<p>The UI design incorporates several interactive features to enhance user experience:</p>
<ol type="1">
<li><strong>Cross-filtering</strong>: Selections in one panel affect what’s displayed in others</li>
<li><strong>Responsive layout</strong>: Adapts to different screen sizes</li>
<li><strong>State persistence</strong>: Maintains user selections during session</li>
<li><strong>Progressive disclosure</strong>: Shows relevant options based on current context</li>
<li><strong>Search functionality</strong>: Enables quick location of specific entities</li>
<li><strong>Guided analysis</strong>: Optional tooltips explaining dashboard features</li>
</ol>
</section>
<section id="color-scheme-and-accessibility" class="level3">
<h3 class="anchored" data-anchor-id="color-scheme-and-accessibility">6.6 Color Scheme and Accessibility</h3>
<p>The dashboard follows a consistent color scheme:</p>
<ul>
<li><strong>Ministries</strong>: Blue shades (#1f77b4 and variants)</li>
<li><strong>Agencies</strong>: Orange shades (#ff7f0e and variants)</li>
<li><strong>Suppliers</strong>: Green shades (#2ca02c and variants)</li>
<li><strong>Financial grades</strong>: Sequential color scale from light to dark</li>
</ul>
<p>Accessibility features include:</p>
<ul>
<li>Color-blind friendly palette</li>
<li>Sufficient contrast ratios</li>
<li>Text alternatives for graphical elements</li>
<li>Keyboard navigation support</li>
<li>Screen reader compatibility</li>
</ul>
</section>
<section id="mockup-preview" class="level3">
<h3 class="anchored" data-anchor-id="mockup-preview">6.7 Mockup Preview</h3>
<p>Below is a schematic representation of the dashboard layout:</p>
<iframe src="mockup1.html" width="100%" height="600px" frameborder="0"></iframe>
<p>This UI design provides a flexible, intuitive interface for exploring the complex relationships in GeBiz procurement data while maintaining consistent visual language and accessibility standards.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>